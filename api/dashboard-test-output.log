
[0;34m========================================[0m
[0;34mPhase 0: Authentication & Setup[0m
[0;34m========================================[0m

[1;33mTEST 0.1: Admin Login[0m
[0;32mâœ“ Admin logged in successfully[0m
[1;33mTEST 0.2: Create Fresh PCO User[0m
[0;32mâœ“ PCO user created (ID: 14, Number: 25969)[0m
[1;33mTEST 0.3: PCO Login[0m
[0;32mâœ“ PCO logged in successfully (ID: 14)[0m
[1;33mTEST 0.4: Get Test Client[0m
[0;32mâœ“ Test client found (ID: 1)[0m
[1;33mTEST 0.5: Assign PCO to Client[0m
[0;31mâœ— Assignment failed[0m
Response: {"success":false,"message":"Some clients already have active PCO assignments","conflicts":[{"client_id":1,"client_name":"ABC Restaurant Sdn Bhd (Updated)","current_pco_id":13}],"suggestion":"Unassign existing PCOs first or use force parameter"}

[0;34m========================================[0m
[0;34mPhase 1: Dashboard Summary Endpoint[0m
[0;34m========================================[0m

[1;33mTEST 1.1: Get Dashboard Summary (No Reports Yet)[0m
[0;31mâœ— Dashboard summary failed[0m
Response: {"success":false,"message":"Failed to fetch dashboard summary","error":"Unknown column 'next_service_date' in 'where clause'"}
[1;33mTEST 1.2: Verify Performance Metrics Structure[0m
[0;31mâœ— Performance metrics incomplete[0m
[1;33mTEST 1.3: Dashboard Without Authentication[0m
[0;32mâœ“ Unauthorized access correctly denied[0m

[0;34m========================================[0m
[0;34mPhase 2: Create Test Reports for Dashboard Data[0m
[0;34m========================================[0m

[1;33mTEST 2.1: Create Draft Report[0m
[0;31mâœ— Report creation failed[0m
Response: {"success":false,"message":"You are not assigned to this client"}
[1;33mTEST 2.2: Submit Report[0m
[0;31mâœ— Report submission failed[0m
Response: {"success":false,"message":"Report not found, not owned by you, or already submitted"}
[1;33mTEST 2.3: Verify Dashboard Shows Pending Report[0m
./test-pco-dashboard.sh: line 281: [: null: integer expression expected
[0;31mâœ— Pending report not reflected in dashboard[0m

[0;34m========================================[0m
[0;34mPhase 3: Upcoming Assignments Endpoint[0m
[0;34m========================================[0m

[1;33mTEST 3.1: Get Upcoming Assignments (Default 7 Days)[0m
[0;31mâœ— Upcoming assignments failed[0m
Response: {"success":false,"message":"Failed to fetch upcoming assignments","error":"Unknown column 'ca.next_service_date' in 'field list'"}
[1;33mTEST 3.2: Verify Assignment Structure[0m
[0;31mâœ— Assignment structure incomplete[0m
[1;33mTEST 3.3: Custom Days Ahead (14 Days)[0m
[0;31mâœ— 14-day lookahead failed[0m
[1;33mTEST 3.4: Invalid Days Ahead (Out of Range)[0m
[0;32mâœ“ Invalid days_ahead correctly rejected[0m

[0;34m========================================[0m
[0;34mPhase 4: Recent Reports Endpoint[0m
[0;34m========================================[0m

[1;33mTEST 4.1: Get Recent Reports (Default Limit)[0m
[0;31mâœ— Recent reports failed[0m
Response: {"success":false,"message":"Failed to fetch recent reports","error":"Table 'kpspestcontrol_app.report_bait_stations' doesn't exist"}
[1;33mTEST 4.2: Verify Report Structure[0m
[0;31mâœ— Report structure incomplete[0m
[1;33mTEST 4.3: Filter by Status (Pending)[0m
[0;31mâœ— Status filter failed[0m
[1;33mTEST 4.4: Custom Limit[0m
[0;31mâœ— Custom limit failed[0m

[0;34m========================================[0m
[0;34mPhase 5: Declined Reports Endpoint[0m
[0;34m========================================[0m

[1;33mTEST 5.1: Get Declined Reports (Should Be Empty)[0m
[0;31mâœ— Declined reports endpoint failed[0m
[1;33mTEST 5.2: Decline Report by Admin[0m
[0;31mâœ— Report decline failed[0m
Response: {"success":false,"message":"Report not found or not in pending status"}
[1;33mTEST 5.3: Verify Declined Report Appears[0m
./test-pco-dashboard.sh: line 460: [: null: integer expression expected
[0;31mâœ— Declined report not appearing[0m
[1;33mTEST 5.4: Verify Declined Report Structure[0m
[0;31mâœ— Declined report structure incomplete[0m

[0;34m========================================[0m
[0;34mPhase 6: Statistics Endpoint[0m
[0;34m========================================[0m

[1;33mTEST 6.1: Get Statistics (Default 30 Days)[0m
[0;32mâœ“ Statistics retrieved (Submitted: 0, Approval: 0%)[0m
[1;33mTEST 6.2: Verify Report Types Breakdown[0m
[0;31mâœ— Report types incomplete[0m
[1;33mTEST 6.3: Verify Monthly Trend[0m
[0;32mâœ“ Monthly trend data present (Months: 0)[0m
[1;33mTEST 6.4: Custom Period (7 Days)[0m
[0;32mâœ“ Custom period applied (7 days)[0m
[1;33mTEST 6.5: Invalid Period (Out of Range)[0m
[0;32mâœ“ Invalid period correctly rejected[0m

[0;34m========================================[0m
[0;34mPhase 7: Dashboard After Report Lifecycle[0m
[0;34m========================================[0m

[1;33mTEST 7.1: Approve Previously Declined Report[0m
[0;31mâœ— Report resubmission failed[0m
[1;33mTEST 7.2: Verify Dashboard After Approval[0m
./test-pco-dashboard.sh: line 595: [: null: integer expression expected
[0;31mâœ— Dashboard not updated after approval[0m
[1;33mTEST 7.3: Verify Declined Reports Empty After Approval[0m
[0;31mâœ— Declined report still showing after approval[0m

[0;34m========================================[0m
[0;34mPhase 8: Performance & Edge Cases[0m
[0;34m========================================[0m

[1;33mTEST 8.1: Dashboard Response Time[0m
[0;32mâœ“ Dashboard responds quickly (97ms < 1000ms)[0m
[1;33mTEST 8.2: Admin Cannot Access PCO Dashboard[0m
[0;32mâœ“ Admin correctly denied access to PCO dashboard[0m
[1;33mTEST 8.3: Invalid Query Parameters Handled[0m
[0;31mâœ— Should handle invalid parameters gracefully[0m

[0;34m========================================[0m
[0;34mPHASE 4.1: PCO DASHBOARD TEST RESULTS[0m
[0;34m========================================[0m

[0;34mTotal Tests:[0m 34
[0;32mPassed:[0m 12
[0;31mFailed:[0m 22

[0;34mPass Rate:[0m 35.3%

[0;31m========================================[0m
[0;31mSOME TESTS FAILED[0m
[0;31mPlease review and fix issues[0m
[0;31m========================================[0m
