
[0;34m========================================[0m
[0;34mSETUP: Authentication[0m
[0;34m========================================[0m

[1;33mTEST 0.1:[0m Admin Login
[0;32mâœ“ PASS:[0m Admin authenticated successfully
[1;33mTEST 0.2:[0m Create fresh PCO user for testing
[0;32mâœ“ PASS:[0m PCO user created (ID: 18, Number: 27823)
[1;33mTEST 0.3:[0m PCO Login
[0;32mâœ“ PASS:[0m PCO authenticated successfully

[0;34m========================================[0m
[0;34mSETUP: Test Data Preparation[0m
[0;34m========================================[0m

[0;32mâœ“ PASS:[0m Test data prepared (Client: 1, Chemical: 5)
[1;33mTEST 0.4:[0m Assign PCO to Client
[0;32mâœ“ PASS:[0m PCO (ID: 18) assigned to Client (ID: 1)

[0;34m========================================[0m
[0;34mTEST GROUP 1: Authentication & Authorization[0m
[0;34m========================================[0m

[1;33mTEST 1.1:[0m Access without token (should fail)
[0;32mâœ“ PASS:[0m Unauthorized access blocked correctly
[1;33mTEST 1.2:[0m PCO access to own reports endpoint
[0;32mâœ“ PASS:[0m PCO can access own reports endpoint
[1;33mTEST 1.3:[0m Admin access to all reports endpoint
[0;32mâœ“ PASS:[0m Admin can access all reports endpoint

[0;34m========================================[0m
[0;34mTEST GROUP 2: Report Creation[0m
[0;34m========================================[0m

[1;33mTEST 2.1:[0m Create draft report
[0;32mâœ“ PASS:[0m Draft report created (ID: 2)
[1;33mTEST 2.2:[0m Attempt to create duplicate draft (should fail)
[0;32mâœ“ PASS:[0m Duplicate draft blocked correctly
[1;33mTEST 2.3:[0m Create report without PCO assignment (should fail)
[0;32mâœ“ PASS:[0m Unassigned client check working

[0;34m========================================[0m
[0;34mTEST GROUP 3: Bait Station Management[0m
[0;34m========================================[0m

[1;33mTEST 3.1:[0m Add bait station with chemicals
[0;31mâœ— FAIL:[0m Failed to add bait station
[0;31m  Response:[0m {"success":false,"message":"Failed to add bait station","error":"Bind parameters must not contain undefined. To pass SQL NULL specify JS null"}
[1;33mTEST 3.2:[0m Update bait station
[0;31mâœ— FAIL:[0m Failed to update bait station
[0;31m  Response:[0m {"success":false,"message":"Station not found or report not editable"}
[1;33mTEST 3.3:[0m Add second bait station (outside)
[0;31mâœ— FAIL:[0m Failed to add second bait station
[0;31m  Response:[0m {"success":false,"message":"Failed to add bait station","error":"Bind parameters must not contain undefined. To pass SQL NULL specify JS null"}

[0;34m========================================[0m
[0;34mTEST GROUP 4: Fumigation Management[0m
[0;34m========================================[0m

[1;33mTEST 4.1:[0m Update fumigation data
[0;32mâœ“ PASS:[0m Fumigation data updated (3 areas, 2 pests, 1 chemical)
[1;33mTEST 4.2:[0m Update fumigation with empty areas (should fail)
[0;32mâœ“ PASS:[0m Empty areas validation working

[0;34m========================================[0m
[0;34mTEST GROUP 5: Insect Monitor Management[0m
[0;34m========================================[0m

[1;33mTEST 5.1:[0m Add fly trap insect monitor
[0;32mâœ“ PASS:[0m Fly trap monitor added (ID: 3)
[1;33mTEST 5.2:[0m Add box monitor
[0;32mâœ“ PASS:[0m Box monitor added
[1;33mTEST 5.3:[0m Update insect monitor
[0;31mâœ— FAIL:[0m Failed to update insect monitor
[0;31m  Response:[0m {"success":false,"message":"Failed to update insect monitor","error":"Bind parameters must not contain undefined. To pass SQL NULL specify JS null"}

[0;34m========================================[0m
[0;34mTEST GROUP 6: Report Retrieval[0m
[0;34m========================================[0m

[1;33mTEST 6.1:[0m Get report by ID with all sub-modules
[0;31mâœ— FAIL:[0m Report data incomplete
[0;31m  Response:[0m Bait: 0, Areas: 3, Monitors: 2
[1;33mTEST 6.2:[0m Get PCO reports list
[0;32mâœ“ PASS:[0m PCO reports list retrieved (1 drafts)
[1;33mTEST 6.3:[0m Admin view should NOT see drafts
[0;32mâœ“ PASS:[0m Admin correctly excludes draft reports (critical business rule)

[0;34m========================================[0m
[0;34mTEST GROUP 7: Report Update[0m
[0;34m========================================[0m

[1;33mTEST 7.1:[0m Update draft report
[0;31mâœ— FAIL:[0m Failed to update draft report
[0;31m  Response:[0m {"success":false,"message":"Failed to update report","error":"Bind parameters must not contain undefined. To pass SQL NULL specify JS null"}

[0;34m========================================[0m
[0;34mTEST GROUP 8: Report Submission & Auto-Unassign[0m
[0;34m========================================[0m

[1;33mTEST 8.1:[0m Submit report (should auto-unassign PCO)
[0;31mâœ— FAIL:[0m Failed to submit report
[0;31m  Response:[0m {"success":false,"message":"Report is incomplete and cannot be submitted","missing_requirements":["PCO signature","Client signature","Client signature name","At least one bait station (report type requires bait inspection data)"]}
[1;33mTEST 8.2:[0m Verify PCO auto-unassigned from client
[0;31mâœ— FAIL:[0m PCO should be auto-unassigned after submission
[0;31m  Response:[0m Found 3 active assignments
[1;33mTEST 8.3:[0m Verify report status changed to pending
[0;31mâœ— FAIL:[0m Report should be in pending status
[0;31m  Response:[0m Status: draft

[0;34m========================================[0m
[0;34mTEST GROUP 9: Admin Review Workflow[0m
[0;34m========================================[0m

[1;33mTEST 9.1:[0m Get pending reports
[0;31mâœ— FAIL:[0m Should have at least 1 pending report
[0;31m  Response:[0m {"success":true,"data":[],"total_pending":0}

[0;34m========================================[0m
[0;34mTEST GROUP 10: Admin Decline & PCO Reassignment[0m
[0;34m========================================[0m

[1;33mTEST 10.1:[0m Decline without admin_notes (should fail)
[0;31mâœ— FAIL:[0m Should require admin_notes for decline
[0;31m  Response:[0m {"success":false,"message":"Validation failed for body","errors":["Admin notes are required when declining a report"]}
[1;33mTEST 10.2:[0m Decline with short admin_notes (should fail)
[0;32mâœ“ PASS:[0m Minimum length validation working (10 chars required)
[1;33mTEST 10.3:[0m Decline report with proper feedback
[0;31mâœ— FAIL:[0m Failed to decline report
[0;31m  Response:[0m {"success":false,"message":"Report not found or not in pending status"}
[1;33mTEST 10.4:[0m Verify PCO reassigned to client for revision
[0;31mâœ— FAIL:[0m PCO should be reassigned after decline
[0;31m  Response:[0m Found 3 active assignments
[1;33mTEST 10.5:[0m Verify report status changed to declined
[0;31mâœ— FAIL:[0m Report should be declined with admin_notes
[0;31m  Response:[0m Status: draft

[0;34m========================================[0m
[0;34mTEST GROUP 11: Resubmit & Approval[0m
[0;34m========================================[0m

[1;33mTEST 11.1:[0m Resubmit report after revision
[0;31mâœ— FAIL:[0m Failed to resubmit report
[0;31m  Response:[0m {"success":false,"message":"Report is incomplete and cannot be submitted","missing_requirements":["PCO signature","Client signature","Client signature name","At least one bait station (report type requires bait inspection data)"]}
[1;33mTEST 11.2:[0m Approve report
[0;31mâœ— FAIL:[0m Failed to approve report
[0;31m  Response:[0m {"success":false,"message":"Report not found or not in pending status"}
[1;33mTEST 11.3:[0m Verify report status changed to approved
[0;31mâœ— FAIL:[0m Report should be approved with reviewer
[0;31m  Response:[0m Status: draft, Reviewer: null

[0;34m========================================[0m
[0;34mTEST GROUP 12: Pre-fill Data[0m
[0;34m========================================[0m

[1;33mTEST 12.1:[0m Get pre-fill data from last approved report
[0;31mâœ— FAIL:[0m Pre-fill data incomplete
[0;31m  Response:[0m Stations: 0, Areas: 0

[0;34m========================================[0m
[0;34mTEST GROUP 13: Edit Restrictions[0m
[0;34m========================================[0m

[1;33mTEST 13.1:[0m Attempt to edit submitted report (should fail)
[0;32mâœ“ PASS:[0m Non-draft report edit blocked correctly
[1;33mTEST 13.2:[0m Attempt to delete approved report (should fail)
[0;31mâœ— FAIL:[0m Should only allow deleting draft reports
[0;31m  Response:[0m {"success":true,"message":"Report deleted successfully"}

[0;34m========================================[0m
[0;34mTEST GROUP 14: Validation Tests[0m
[0;34m========================================[0m

[1;33mTEST 14.1:[0m Create report with future service date (should fail)
[0;32mâœ“ PASS:[0m Future date validation working
[1;33mTEST 14.2:[0m Add bait station with invalid location (should fail)
[0;32mâœ“ PASS:[0m Location enum validation working

[0;34m========================================[0m
[0;34mCLEANUP: Delete Test Report[0m
[0;34m========================================[0m

[1;33mNote: Test report ID 2 was approved and cannot be deleted automatically[0m

[0;34m========================================[0m
[0;34mTEST SUMMARY[0m
[0;34m========================================[0m

Total Tests: [0;34m40[0m
Passed: [0;32m21[0m
Failed: [0;31m19[0m

[0;31m========================================[0m
[0;31mSOME TESTS FAILED âœ—[0m
[0;31m========================================[0m

[0;31mPlease review the failures above[0m
